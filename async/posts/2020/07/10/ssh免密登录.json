{"tags":[{"name":"运维","permalink":"https://xuanxiaoming.github.io/tags/%E8%BF%90%E7%BB%B4/","url":"/async/tags/运维.json","count":4},{"name":"linux","permalink":"https://xuanxiaoming.github.io/tags/linux/","url":"/async/tags/linux.json","count":3}],"categories":[],"url":"/async/posts/2020/07/10/ssh免密登录.json","date":1594354766000,"path":{"year":2020,"month":7,"day":10,"name":"ssh免密登录"},"title":"ssh免密登录","permalink":"https://xuanxiaoming.github.io/2020/07/10/ssh%E5%85%8D%E5%AF%86%E7%99%BB%E5%BD%95/","content":"<h1 id=\"ssh免密登录\"><a href=\"#ssh免密登录\" class=\"headerlink\" title=\"ssh免密登录\"></a>ssh免密登录</h1><ol>\n<li><p>在系统上安装ssh后，生成秘钥</p>\n<pre class=\"line-numbers language-shell\"><code class=\"language-shell\">> ssh-keygen -t rsa -C \"info\"\n\n-t 指定加密算法\n-C 在密文尾部加标记信息 <span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span></span></code></pre>\n</li>\n</ol>\n<ol start=\"2\">\n<li><p>将公钥发布到待免密登录的机器上</p>\n<pre class=\"line-numbers language-shell\"><code class=\"language-shell\">> cd ~/.ssh/\n\n# 有两种方式发送公钥到远程机器上 \n> ssh-copy-id -i [本地公钥文件id_rsa.pub路径] 用户名@IP\n# 这样一部就可以将公钥写到远程机器的 /.ssh/authorized_keys 中，缺点是默认22端口，不可更改\n> scp ~/.ssh/id_rsa.pub 用户名@IP:.ssh/id_rsa_remote.pub\n> cat id_rsa_remote.pub >> authorized_keys\n# 这种方式既可以设置端口，也可以用于对方机器非root用户的情况（需要密码）<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<pre class=\"line-numbers language-shell\"><code class=\"language-shell\"># 在我们想使用脚本自动完成秘钥发布工作时，可以使用sshpass解决人机交互问题\n> sshpass -p '密码' ssh-copy-id \"-o StrictHostKeyChecking=no\" 用户名@IP\n# sshpass会为你的首次连接自动填充密码\n# 同时使用\"-o StrictHostKeyChecking=no\"解决输入密码后的网络校验工作，避免首次登录输入yes\n# 这样就解决了两步人机交互问题，实现自动化<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<blockquote>\n<p>注意：</p>\n<ol>\n<li><p>B机器上有A机器的公钥，则A可以免密登录到B，不要记反了。</p>\n</li>\n<li><p>可以使用 <code>passwd 用户名</code> 更改用户的密码</p>\n</li>\n<li><p>需要在sshd的配置文件 <code>/etc/ssh/sshd_config</code> 中增加 <code>PermitRootLogin yes</code> 和 <code>PubkeyAuthentication yes</code>，用于打开root用户远程访问和秘钥验证登录</p>\n</li>\n</ol>\n</blockquote>\n</li>\n</ol>\n<ol start=\"3\">\n<li><p>ssh连接到到机器上</p>\n<pre><code>配置完成后，使用 `ssh 用户名@IP` 连接远程机器，首次连接会询问是否继续，输入yes，会在本地生成known_hosts文件用于记录已访问机器</code></pre></li>\n</ol>\n"}