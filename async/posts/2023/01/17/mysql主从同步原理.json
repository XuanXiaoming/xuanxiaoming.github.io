{"tags":[{"name":"数据库","permalink":"https://xuanxiaoming.github.io/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/","url":"/async/tags/数据库.json","count":5}],"categories":[],"url":"/async/posts/2023/01/17/mysql主从同步原理.json","date":1673945966000,"path":{"year":2023,"month":1,"day":17,"name":"mysql主从同步原理"},"title":"MySQL主从同步原理","permalink":"https://xuanxiaoming.github.io/2023/01/17/mysql%E4%B8%BB%E4%BB%8E%E5%90%8C%E6%AD%A5%E5%8E%9F%E7%90%86/","content":"<h1 id=\"什么是MySQL主从同步\"><a href=\"#什么是MySQL主从同步\" class=\"headerlink\" title=\"什么是MySQL主从同步\"></a>什么是MySQL主从同步</h1><p>当master(主)库的数据发生变化的时候，变化会实时的同步到slave(从)库。</p>\n<h1 id=\"主从同步有什么好处\"><a href=\"#主从同步有什么好处\" class=\"headerlink\" title=\"主从同步有什么好处\"></a>主从同步有什么好处</h1><ul>\n<li><p>水平扩展数据库的负载能力。</p>\n</li>\n<li><p>容错，高可用。Failover(失败切换)/High Availability</p>\n</li>\n<li><p>数据备份。</p>\n</li>\n</ul>\n<h1 id=\"主从同步的原理\"><a href=\"#主从同步的原理\" class=\"headerlink\" title=\"主从同步的原理\"></a>主从同步的原理</h1><p>不管是delete、update、insert，还是创建函数、存储过程，所有的操作都在master上。当master有操作的时候，slave会快速的接收到这些操作，从而做同步。</p>\n<p>在master机器上，主从同步事件会被写到特殊的log文件中（binary-log），然后slave读取主从同步事件，并根据读取的事件变化，在slave库上做相应的更改。</p>\n<p>主从同步事件有3种形式：statement、row、mixed。</p>\n<ol>\n<li><p>statement：对数据库操作的sql语句写入到binlog中。</p>\n</li>\n<li><p>row：将每一条数据的变化写入到binlog中。</p>\n</li>\n<li><p>mixed：statement与row的混合。Mysql决定什么时候写statement格式的，什么时候写row格式的binlog。</p>\n</li>\n</ol>\n<h2 id=\"在master机器上的操作\"><a href=\"#在master机器上的操作\" class=\"headerlink\" title=\"在master机器上的操作\"></a>在master机器上的操作</h2><p>当master上的数据发生改变的时候，该事件(insert、update、delete)变化会按照顺序写入到binlog中。</p>\n<p>当slave连接到master的时候，master机器会为slave开启binlog dump线程。当master 的 binlog发生变化的时候，binlog dump线程会通知slave，并将相应的binlog内容发送给slave。</p>\n<h2 id=\"在slave机器上的操作\"><a href=\"#在slave机器上的操作\" class=\"headerlink\" title=\"在slave机器上的操作\"></a>在slave机器上的操作</h2><p>当主从同步开启的时候，slave上会创建2个线程。</p>\n<ul>\n<li><p>I/O线程</p>\n<p>该线程连接到master机器，master机器上的binlog dump线程会将binlog的内容发送给该I/O线程。</p>\n<p>该I/O线程接收到binlog内容后，再将内容写入到本地的relay log。</p>\n</li>\n<li><p>SQL线程</p>\n<p>该线程读取I/O线程写入的relay log。并且根据relay log的内容对slave数据库做相应的操作。</p>\n</li>\n</ul>\n<h2 id=\"在master、slave上查看上述线程\"><a href=\"#在master、slave上查看上述线程\" class=\"headerlink\" title=\"在master、slave上查看上述线程\"></a><strong>在master、slave上查看上述线程</strong></h2><p>使用SHOW PROCESSLIST命令可以查看。在master机器上查看binlog dump线程。</p>\n"}